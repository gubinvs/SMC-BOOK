{"ast":null,"code":"var _jsxFileName = \"/home/gubinvs/ENCOMPONENT/shop/src/Basket/Basket.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport Header from \"../Header/Header.jsx\";\nimport \"./Basket.css\";\nimport Cart from \"./Cart.jsx\";\nimport ApiUrl from '../js/ApiUrl.js';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Basket = () => {\n  _s();\n  const [fullBasket, setFullBasket] = useState([]);\n  const [newItem, setNewItem] = useState(null);\n\n  // Получаем артикул из строки запроса\n  const param = new URLSearchParams(window.location.search).get(\"vendorCode\");\n\n  // Получаем данные из localStorage с безопасным парсингом\n  const getParsedLocalStorage = key => {\n    try {\n      const item = localStorage.getItem(key);\n      return item ? JSON.parse(item) : [];\n    } catch (error) {\n      console.error(`Ошибка парсинга ${key}:`, error);\n      localStorage.removeItem(key); // очищаем поврежденный ключ\n      return [];\n    }\n  };\n  const nkuItem = getParsedLocalStorage(\"basketItem\");\n  const cardItem = getParsedLocalStorage(\"cart\");\n  const searchItem = getParsedLocalStorage(\"search\");\n\n  // Получаем товар по vendorCode из URL\n  useEffect(() => {\n    if (param) {\n      fetch(ApiUrl + \"/api/BasketItem/\" + param, {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }).then(response => {\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        return response.json();\n      }).then(data => {\n        if (data.length > 0) {\n          const item = data[0];\n          setNewItem({\n            id: item.Id + 1000,\n            guidId: item.GuidId || item.Guid,\n            vendorCode: item.VendorCode,\n            name: item.Name || item.NameComponent,\n            price: item.PriceNku || item.Price,\n            quantity: 1,\n            image: item.ImagesLink || item.ImgLinkIconCard\n          });\n        }\n      }).catch(error => console.log(\"Ошибка получения данных:\", error));\n    }\n  }, [param]);\n\n  // Обновляем корзину при добавлении нового товара\n  useEffect(() => {\n    if (newItem) {\n      const basketItem = getParsedLocalStorage(\"basketItem\");\n      const updatedBasket = [...basketItem, newItem];\n      const uniqueItems = Array.from(new Map(updatedBasket.map(item => [item.id, item])).values());\n      setFullBasket(uniqueItems);\n      localStorage.setItem(\"basketItem\", JSON.stringify(uniqueItems));\n    }\n  }, [newItem]);\n\n  // Обработка элементов из localStorage\n  const processedNku = nkuItem.map(i => ({\n    id: i.id,\n    guidId: i.guidId,\n    vendorCode: i.vendorCode,\n    name: i.name,\n    price: i.price,\n    quantity: i.quantity,\n    image: i.image\n  }));\n  const processedCard = cardItem.map(c => ({\n    id: c.id + 2000,\n    guidId: c.guidId,\n    vendorCode: c.vendorСode,\n    name: c.nameComponent,\n    price: c.price,\n    quantity: c.quantity,\n    image: c.basketImgPath\n  }));\n  const processedSearch = searchItem.map(x => ({\n    id: x.id + 3000,\n    guidId: x.guidId,\n    vendorCode: x.vendorCode,\n    name: x.name,\n    price: x.price,\n    quantity: x.quantity,\n    image: x.basketImgPath\n  }));\n  const combinedItems = [...processedNku, ...processedCard, ...processedSearch];\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Cart, {\n      item: combinedItems\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true);\n};\n_s(Basket, \"LuPVU3iKMxLVlX6qqjDzDJDl4R0=\");\n_c = Basket;\nexport default Basket;\nvar _c;\n$RefreshReg$(_c, \"Basket\");","map":{"version":3,"names":["React","useState","useEffect","Header","Cart","ApiUrl","jsxDEV","_jsxDEV","Fragment","_Fragment","Basket","_s","fullBasket","setFullBasket","newItem","setNewItem","param","URLSearchParams","window","location","search","get","getParsedLocalStorage","key","item","localStorage","getItem","JSON","parse","error","console","removeItem","nkuItem","cardItem","searchItem","fetch","method","headers","then","response","ok","Error","status","json","data","length","id","Id","guidId","GuidId","Guid","vendorCode","VendorCode","name","Name","NameComponent","price","PriceNku","Price","quantity","image","ImagesLink","ImgLinkIconCard","catch","log","basketItem","updatedBasket","uniqueItems","Array","from","Map","map","values","setItem","stringify","processedNku","i","processedCard","c","vendorСode","nameComponent","basketImgPath","processedSearch","x","combinedItems","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/home/gubinvs/ENCOMPONENT/shop/src/Basket/Basket.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport Header from \"../Header/Header.jsx\";\nimport \"./Basket.css\";\nimport Cart from \"./Cart.jsx\";\nimport ApiUrl from '../js/ApiUrl.js';\n\nconst Basket = () => {\n    const [fullBasket, setFullBasket] = useState([]);\n    const [newItem, setNewItem] = useState(null);\n\n    // Получаем артикул из строки запроса\n    const param = new URLSearchParams(window.location.search).get(\"vendorCode\");\n\n    // Получаем данные из localStorage с безопасным парсингом\n    const getParsedLocalStorage = (key) => {\n        try {\n            const item = localStorage.getItem(key);\n            return item ? JSON.parse(item) : [];\n        } catch (error) {\n            console.error(`Ошибка парсинга ${key}:`, error);\n            localStorage.removeItem(key); // очищаем поврежденный ключ\n            return [];\n        }\n    };\n\n    const nkuItem = getParsedLocalStorage(\"basketItem\");\n    const cardItem = getParsedLocalStorage(\"cart\");\n    const searchItem = getParsedLocalStorage(\"search\");\n\n    // Получаем товар по vendorCode из URL\n    useEffect(() => {\n        if (param) {\n            fetch(ApiUrl + \"/api/BasketItem/\" + param, {\n                method: \"GET\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                },\n            })\n                .then((response) => {\n                    if (!response.ok) {\n                        throw new Error(`HTTP error! status: ${response.status}`);\n                    }\n                    \n                    return response.json();\n                })\n                .then((data) => {\n                    \n                    if (data.length > 0) {\n                        const item = data[0];\n                        setNewItem({\n                            id: item.Id + 1000,\n                            guidId: item.GuidId || item.Guid,\n                            vendorCode: item.VendorCode,\n                            name: item.Name || item.NameComponent,\n                            price: item.PriceNku || item.Price,\n                            quantity: 1,\n                            image: item.ImagesLink || item.ImgLinkIconCard\n                        });\n                    }\n                })\n                .catch((error) => console.log(\"Ошибка получения данных:\", error));\n        }\n    }, [param]);\n\n    // Обновляем корзину при добавлении нового товара\n    useEffect(() => {\n        if (newItem) {\n            const basketItem = getParsedLocalStorage(\"basketItem\");\n\n            const updatedBasket = [...basketItem, newItem];\n            const uniqueItems = Array.from(\n                new Map(updatedBasket.map((item) => [item.id, item])).values()\n            );\n\n            setFullBasket(uniqueItems);\n            localStorage.setItem(\"basketItem\", JSON.stringify(uniqueItems));\n        }\n    }, [newItem]);\n\n    // Обработка элементов из localStorage\n    const processedNku = nkuItem.map(i => ({\n        id: i.id,\n        guidId: i.guidId,\n        vendorCode: i.vendorCode,\n        name: i.name,\n        price: i.price,\n        quantity: i.quantity,\n        image: i.image\n    }));\n\n    const processedCard = cardItem.map(c => ({\n        id: c.id + 2000,\n        guidId: c.guidId,\n        vendorCode: c.vendorСode,\n        name: c.nameComponent,\n        price: c.price,\n        quantity: c.quantity,\n        image: c.basketImgPath\n    }));\n\n    const processedSearch = searchItem.map(x => ({\n        id: x.id + 3000,\n        guidId: x.guidId,\n        vendorCode: x.vendorCode,\n        name: x.name,\n        price: x.price,\n        quantity: x.quantity,\n        image: x.basketImgPath\n    }));\n\n    const combinedItems = [...processedNku, ...processedCard, ...processedSearch];\n\n    return (\n        <>\n            <Header />\n            <Cart item={combinedItems} />\n        </>\n    );\n};\n\nexport default Basket;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}